<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For You ❤️</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; background-color: #000; overflow: hidden; font-family: 'Montserrat', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        #overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; color: white; z-index: 10; pointer-events: none; 
            width: 85%; max-width: 600px;
        }

        h1 { 
            font-size: clamp(1.8rem, 6vw, 2.8rem); 
            text-shadow: 0 0 20px #ff0055; 
            margin-bottom: 15px; opacity: 0; transition: opacity 2s; font-weight: 600;
        }

        #typewriter { 
            font-size: clamp(0.95rem, 4vw, 1.15rem); 
            line-height: 1.6; color: #efefef; font-weight: 300; 
            min-height: 100px; padding: 0 10px;
        }

        .click-hint {
            position: absolute; bottom: 40px; width: 100%; text-align: center;
            color: #888; font-size: 0.75rem; letter-spacing: 2px; 
            animation: blink 2s infinite; font-weight: 400;
        }

        @keyframes blink { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }
    </style>
</head>
<body>

    <audio id="bgMusic" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <div id="overlay">
        <h1 id="title">Happy Birthday! ✨</h1>
        <div id="typewriter"></div>
    </div>

    <div class="click-hint">TAP ANYWHERE TO START</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>

    <script>
        // --- Setup ---
        const totalParticles = 3000;
        const bgParticleCount = 1500; // Extra particles for the sides
        const message = "To the girl who makes every moment feel like a dream—Happy Birthday. I wanted to build something as unique and bright as you are. Watching these particles come together to form a heart is exactly how I feel when I’m with you; everything just clicks into place. You are my light in the dark, my favorite adventure, and my whole heart. I hope your day is as beautiful as the soul you share with the world.";

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        camera.position.z = window.innerWidth < 600 ? 50 : 40;

        // --- Heart Logic ---
        const geometry = new THREE.BufferGeometry();
        const positions = new Float32Array(totalParticles * 3);
        const colors = new Float32Array(totalParticles * 3);
        const heartPoints = [];

        // Mathematical Heart Formula (Symmetrical)
        function getHeartPoint(t) {
            const scale = 1.3;
            const x = 16 * Math.pow(Math.sin(t), 3);
            const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
            return new THREE.Vector3(x * scale, y * scale, 0);
        }

        for (let i = 0; i < totalParticles; i++) {
            positions[i * 3] = (Math.random() - 0.5) * 150;
            positions[i * 3 + 1] = (Math.random() - 0.5) * 150;
            positions[i * 3 + 2] = (Math.random() - 0.5) * 100;

            colors[i * 3] = 1.0; colors[i * 3 + 1] = 0.8; colors[i * 3 + 2] = 0.6; // Initial Gold/White

            const t = (i / totalParticles) * Math.PI * 2;
            heartPoints.push(getHeartPoint(t));
        }

        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

        const heartSystem = new THREE.Points(geometry, new THREE.PointsMaterial({
            size: 0.5, vertexColors: true, blending: THREE.AdditiveBlending, transparent: true, opacity: 0.8
        }));
        scene.add(heartSystem);

        // --- Background Galaxy Logic (Fills the empty space) ---
        const bgGeometry = new THREE.BufferGeometry();
        const bgPositions = new Float32Array(bgParticleCount * 3);
        for (let i = 0; i < bgParticleCount; i++) {
            bgPositions[i * 3] = (Math.random() - 0.5) * 300;     // Wide spread
            bgPositions[i * 3 + 1] = (Math.random() - 0.5) * 200; // Tall spread
            bgPositions[i * 3 + 2] = (Math.random() - 0.5) * 200;
        }
        bgGeometry.setAttribute('position', new THREE.BufferAttribute(bgPositions, 3));
        const bgSystem = new THREE.Points(bgGeometry, new THREE.PointsMaterial({
            size: 0.2, color: 0x444444, transparent: true, opacity: 0.5
        }));
        scene.add(bgSystem);

        // --- Animation Logic ---
        let frame = 0;
        let isHeartFormed = false;

        function typeWriter(text, i) {
            if (i < text.length) {
                document.getElementById("typewriter").innerHTML = text.substring(0, i + 1) + '<span style="color:#ff0055">|</span>';
                setTimeout(() => typeWriter(text, i + 1), 35);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            frame += 0.01;
            const pos = geometry.attributes.position;
            const col = geometry.attributes.color;

            // Heart Animation
            for (let i = 0; i < totalParticles; i++) {
                let x = pos.getX(i), y = pos.getY(i), z = pos.getZ(i);
                
                if (isHeartFormed) {
                    const target = heartPoints[i];
                    pos.setXYZ(i, x + (target.x - x) * 0.05, y + (target.y - y) * 0.05, z + (0 - z) * 0.05);
                    
                    // COLOR CHANGING EFFECT: Cycles through Hues
                    // We use HSL for smooth transitions
                    const hue = (frame * 0.1 + i * 0.0001) % 1; // Slow color shift
                    const color = new THREE.Color().setHSL(hue * 0.2 + 0.85, 0.8, 0.6); // Shifts between Pink and Red
                    col.setXYZ(i, color.r, color.g, color.b);
                } else {
                    pos.setXYZ(i, x + Math.sin(frame + i) * 0.02, y + Math.cos(frame + i) * 0.02, z + Math.sin(frame * 0.5 + i) * 0.02);
                }
            }
            
            // Background Galaxy slow drift
            bgSystem.rotation.y += 0.0005;
            bgSystem.rotation.x += 0.0002;

            pos.needsUpdate = true;
            col.needsUpdate = true;
            heartSystem.rotation.y += 0.002;
            renderer.render(scene, camera);
        }

        const triggerAction = () => {
            if (!isHeartFormed) {
                isHeartFormed = true;
                const audio = document.getElementById('bgMusic');
                audio.play().catch(() => {});
                document.getElementById('title').style.opacity = '1';
                document.querySelector('.click-hint').style.display = 'none';
                setTimeout(() => typeWriter(message, 0), 800);
            }
        };

        window.addEventListener('mousedown', triggerAction);
        window.addEventListener('touchstart', triggerAction);
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.position.z = window.innerWidth < 600 ? 50 : 40;
        });

        animate();
    </script>
</body>
</html>
