<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For You ❤️</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
    
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; font-family: 'Montserrat', sans-serif; }
        #overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; color: white; z-index: 10; pointer-events: none; width: 90%; max-width: 500px;
        }
        h1 { font-size: 2.5rem; text-shadow: 0 0 20px #ff0055; margin-bottom: 20px; opacity: 0; transition: opacity 2s; }
        #typewriter { font-size: 1.1rem; line-height: 1.8; color: #ddd; font-weight: 300; min-height: 150px; }
        .click-hint {
            position: absolute; bottom: 30px; width: 100%; text-align: center;
            color: #666; font-size: 0.8rem; letter-spacing: 3px; animation: blink 2s infinite;
        }
        @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
    </style>
</head>
<body>

    <audio id="bgMusic" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <div id="overlay">
        <h1 id="title">Happy Birthday! ✨</h1>
        <div id="typewriter"></div>
    </div>

    <div class="click-hint">TAP TO OPEN MY HEART</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>

    <script>
        // --- Configuration ---
        const totalParticles = 2500;
        const message = "To the girl who makes every moment feel like a dream—Happy Birthday. I wanted to build something as unique and bright as you are. Watching these particles come together to form a heart is exactly how I feel when I’m with you; everything just clicks into place. You are my light in the dark, my favorite adventure, and my whole heart. I hope your day is as beautiful as the soul you share with the world.";

        // --- Three.js Setup ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        camera.position.z = 35;

        const geometry = new THREE.BufferGeometry();
        const positions = new Float32Array(totalParticles * 3);
        const colors = new Float32Array(totalParticles * 3);
        const heartPoints = [];

        function getHeartPoint(t) {
            const scale = 1.3;
            let x = 16 * Math.pow(Math.sin(t), 3);
            let y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
            let z = Math.sin(t * 4) * 1.5;
            return new THREE.Vector3(x * scale, y * scale, z * scale);
        }

        for (let i = 0; i < totalParticles; i++) {
            positions[i * 3] = (Math.random() - 0.5) * 80;
            positions[i * 3 + 1] = (Math.random() - 0.5) * 80;
            positions[i * 3 + 2] = (Math.random() - 0.5) * 80;
            colors[i * 3] = 1; colors[i * 3 + 1] = 0.9; colors[i * 3 + 2] = 0.7;
            const t = (i / totalParticles) * Math.PI * 2;
            heartPoints.push(getHeartPoint(t));
        }

        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

        const material = new THREE.PointsMaterial({
            size: 0.5, vertexColors: true, blending: THREE.AdditiveBlending, transparent: true, opacity: 0.8
        });

        const particleSystem = new THREE.Points(geometry, material);
        scene.add(particleSystem);

        let frame = 0;
        let isHeartFormed = false;

        function typeWriter(text, i) {
            if (i < text.length) {
                document.getElementById("typewriter").innerHTML = text.substring(0, i + 1) + '<span>|</span>';
                setTimeout(() => typeWriter(text, i + 1), 40);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            frame += 0.01;
            const pos = geometry.attributes.position;
            const col = geometry.attributes.color;

            for (let i = 0; i < totalParticles; i++) {
                let x = pos.getX(i), y = pos.getY(i), z = pos.getZ(i);
                if (isHeartFormed) {
                    const target = heartPoints[i];
                    pos.setXYZ(i, x + (target.x - x) * 0.04, y + (target.y - y) * 0.04, z + (target.z - z) * 0.04);
                    col.setXYZ(i, col.getX(i) + (1.0 - col.getX(i)) * 0.03, col.getY(i) + (0.0 - col.getY(i)) * 0.03, col.getZ(i) + (0.4 - col.getZ(i)) * 0.03);
                } else {
                    pos.setXYZ(i, x + Math.sin(frame + i) * 0.01, y + Math.cos(frame + i) * 0.01, z + Math.sin(frame * 0.5 + i) * 0.01);
                }
            }
            pos.needsUpdate = true; col.needsUpdate = true;
            particleSystem.rotation.y += 0.003;
            renderer.render(scene, camera);
        }

        window.addEventListener('mousedown', () => {
            if (!isHeartFormed) {
                isHeartFormed = true;
                const audio = document.getElementById('bgMusic');
                audio.play().catch(() => console.log("Music blocked or missing"));
                document.getElementById('title').style.opacity = '1';
                document.querySelector('.click-hint').style.display = 'none';
                setTimeout(() => typeWriter(message, 0), 1000);
            }
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
